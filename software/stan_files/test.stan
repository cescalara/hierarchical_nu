functions
{
#include utils.stan
#include interpolation.stan
real spectrum_rng(real alpha,real e_low,real e_up)
{
real uni_sample;
real norm;
norm = ((1-alpha)/((e_up^(1-alpha))-(e_low^(1-alpha))));
uni_sample = uniform_rng(0, 1);
return ((((uni_sample*(1-alpha))/norm)+(e_low^(1-alpha)))^(1/(1-alpha)));
}
real diffuse_bg_rng_shape_rng(real alpha,real e_low,real e_up)
{
real uni_sample;
real norm;
norm = ((1-alpha)/((e_up^(1-alpha))-(e_low^(1-alpha))));
uni_sample = uniform_rng(0, 1);
return ((((uni_sample*(1-alpha))/norm)+(e_low^(1-alpha)))^(1/(1-alpha)));
}
vector diffuse_bg_rng(real alpha,real e_low,real e_up)
{
vector[3] ret_vec;
ret_vec[1] = diffuse_bg_rng_shape_rng(alpha, e_low, e_up);
ret_vec[2] = (acos(uniform_rng(-1, 1))-(pi()/2));
ret_vec[3] = uniform_rng(0, (2*pi()));
return ret_vec;
}
real AtmopshericNumuFlux(real true_energy,vector true_dir)
{
real AtmosphericFluxPolyCoeffs[20,100] = {{ -1.98015639, -2.06990581, -2.28102841, -2.5048243 , -2.73832406,
   -2.98153484, -3.23295258, -3.4836111 , -3.73704168, -3.9929935 ,
   -4.25083558, -4.51097506, -4.77320619, -5.03694404, -5.3016799 ,
   -5.56730132, -5.83391547, -6.10197286, -6.37184525, -6.64436918,
   -6.92212103, -7.20151475, -7.47929293, -7.75687533, -8.03560464,
   -8.31524896, -8.59622776, -8.87892723, -9.16356273, -9.45014546,
   -9.73955079,-10.03194011,-10.32752948,-10.62639137,-10.92863038,
  -11.23418615,-11.54267921,-11.85417477,-12.16882135,-12.48615571,
  -12.80598245,-13.12773531,-13.45154511,-13.77716961,-14.10443447,
  -14.43340331,-14.76372896,-15.09492324,-15.42697458,-15.76005429,
  -16.09441157,-16.43040613,-16.7669652 ,-17.10396077,-17.44180432,
  -17.78061009,-18.12048441,-18.46119902,-18.80257118,-19.14497854,
  -19.48807276,-19.83120512,-20.17383955,-20.51615953,-20.85808813,
  -21.19824132,-21.53516751,-21.86978185,-22.202192  ,-22.53013232,
  -22.85303624,-23.17163324,-23.48569116,-23.79511144,-24.09975962,
  -24.40085482,-24.69940318,-24.99492706,-25.28816168,-25.58040571,
  -25.87460545,-26.17342592,-26.47426044,-26.78133635,-27.09497504,
  -27.41648448,-27.74672402,-28.0862232 ,-28.43231211,-28.78799004,
  -29.15368342,-29.52833128,-29.91235745,-30.2978475 ,-30.70124633,
  -31.10831576,-31.52247839,-31.94063427,-32.35710298,-32.54291653},
 { -1.96881896, -2.05836434, -2.26904568, -2.4924592 , -2.7256061 ,
   -2.96824651, -3.21886201, -3.46941523, -3.722841  , -3.97876364,
   -4.23655653, -4.49655581, -4.75854827, -5.02197119, -5.28634853,
   -5.55157706, -5.81776079, -6.08535483, -6.35472536, -6.62666887,
   -6.90346241, -7.18192496, -7.45917543, -7.73640231, -8.01471194,
   -8.29387189, -8.57424002, -8.85616655, -9.13984845, -9.42529278,
   -9.71338681,-10.00431883,-10.29834896,-10.5955934 ,-10.89620585,
  -11.20017536,-11.50716146,-11.8172602 ,-12.13063834,-12.44685118,
  -12.76571045,-13.08664663,-13.40979359,-13.73489987,-14.06178912,
  -14.39053042,-14.72076341,-15.05199834,-15.38423744,-15.71763462,
  -16.05246328,-16.38908329,-16.72643333,-17.06438687,-17.40335987,
  -17.74347752,-18.0848347 ,-18.42721217,-18.77040724,-19.11471829,
  -19.45981775,-19.80508249,-20.14995348,-20.49452413,-20.83866369,
  -21.18097503,-21.5199386 ,-21.85633371,-22.19023098,-22.51942055,
  -22.84327742,-23.16244717,-23.47678808,-23.78624619,-24.09065326,
  -24.39121707,-24.68895608,-24.98343896,-25.27544343,-25.56633166,
  -25.85904355,-26.15623004,-26.45547035,-26.76095149,-27.07306261,
  -27.39314001,-27.72210914,-28.06050865,-28.40585767,-28.7610871 ,
  -29.12669499,-29.50172088,-29.88657085,-30.27374196,-30.67867108,
  -31.08781571,-31.50433177,-31.92523739,-32.34484626,-32.53213335},
 { -1.95648354, -2.04573474, -2.25577111, -2.47860797, -2.7112297 ,
   -2.9531539 , -3.20285053, -3.45320864, -3.70658079, -3.96246561,
   -4.2202308 , -4.48012851, -4.7419261 , -5.00507435, -5.26912266,
   -5.53396998, -5.79970939, -6.06679625, -6.33559572, -6.60687019,
   -6.88261378, -7.1600597 , -7.43670539, -7.71351773, -7.99137355,
   -8.27003457, -8.54978888, -8.83093956, -9.11365341, -9.39792185,
   -9.68463459, -9.97400139,-10.26632565,-10.56176934,-10.86054129,
  -11.16268879,-11.46791944,-11.77636901,-12.08822999,-12.40308307,
  -12.72075263,-13.04066947,-13.36297225,-13.68740067,-14.01377623,
  -14.34217252,-14.67221431,-15.00340921,-15.33577206,-15.66943793,
  -16.00470402,-16.34193006,-16.68006687,-17.01899033,-17.35912243,
  -17.70060201,-18.04351453,-18.38765397,-18.73280005,-19.07916939,
  -19.42645949,-19.77407922,-20.12144895,-20.46856523,-20.81523946,
  -21.16006394,-21.50144591,-21.84000792,-22.17576677,-22.50656209,
  -22.83169893,-23.15172756,-23.46659175,-23.77627804,-24.08058552,
  -24.3807109 ,-24.67768557,-24.97112759,-25.26186035,-25.55131298,
  -25.84242062,-26.13782224,-26.43529166,-26.73897657,-27.04933828,
  -27.36774575,-27.6951957 ,-28.03223932,-28.37659952,-28.7311423 ,
  -29.09644872,-29.47167075,-29.85721386,-30.24602966,-30.65248756,
  -31.06381012,-31.4828725 ,-31.90684237,-32.33004138,-32.51904513},
 { -1.94329036, -2.03213771, -2.24127793, -2.46329133, -2.69515972,
   -2.93616686, -3.18477605, -3.43479234, -3.68800938, -3.94380291,
   -4.201526  , -4.46133435, -4.722963  , -4.98586582, -5.24960773,
   -5.5140797 , -5.77935263, -6.04587411, -6.31401078, -6.58449618,
   -6.85906085, -7.13536276, -7.41128204, -7.68757935, -7.96491418,
   -8.24303919, -8.52216527, -8.80253585, -9.08427289, -9.36733651,
   -9.65260441, -9.94029803,-10.23075979,-10.52419711,-10.82087925,
  -11.12092154,-11.42409059,-11.73057316,-12.04059775,-12.35378013,
  -12.66996589,-12.98859192,-13.30980512,-13.63333766,-13.95900948,
  -14.28689768,-14.6166103 ,-14.94765091,-15.28004526,-15.6139075 ,
  -15.9495577 ,-16.28735452,-16.62626132,-16.96615712,-17.30747134,
  -17.65035931,-17.99489946,-18.34090396,-18.6881382 ,-19.0367353 ,
  -19.3864236 ,-19.73665259,-20.08682657,-20.43683916,-20.78644088,
  -21.13421833,-21.47850094,-21.8197291 ,-22.15784362,-22.49072396,
  -22.81758876,-23.13887632,-23.45460716,-23.76480156,-24.06922671,
  -24.36906811,-24.66537054,-24.95780507,-25.24724452,-25.53518904,
  -25.82457109,-26.11802057,-26.41351611,-26.71516756,-27.0235136 ,
  -27.33996095,-27.66558331,-28.00094845,-28.34399959,-28.69754235,
  -29.06225369,-29.43741207,-29.82344367,-30.21380494,-30.62173713,
  -31.03531033,-31.45710846,-31.88449348,-32.31182134,-32.50284422},
 { -1.92920943, -2.01751189, -2.22542597, -2.44628129, -2.677076  ,
   -2.91687442, -3.16414132, -3.41358179, -3.66646408, -3.92205039,
   -4.17967263, -4.43937814, -4.70085568, -4.96354904, -5.22702427,
   -5.49114876, -5.75595356, -6.02186361, -6.28924486, -6.55880429,
   -6.83203055, -7.10701844, -7.38203751, -7.65766568, -7.93436567,
   -8.21188269, -8.49034606, -8.76992732, -9.05068651, -9.33253179,
   -9.61630761, -9.90223046,-10.19067161,-10.48187881,-10.77618467,
  -11.07378246,-11.37451047,-11.67862055,-11.98639124,-12.29748739,
  -12.61178896,-12.92874872,-13.2485281 ,-13.57085516,-13.89555032,
  -14.22269364,-14.55187455,-14.88259098,-15.21487713,-15.54882338,
  -15.88477074,-16.223075  ,-16.56271197,-16.90356394,-17.24606888,
  -17.59040141,-17.93663553,-18.28460733,-18.63407227,-18.9850792 ,
  -19.33739503,-19.69052148,-20.04385464,-20.39718089,-20.75018903,
  -21.10146913,-21.44927047,-21.79382096,-22.13495635,-22.47058137,
  -22.79980442,-23.12292654,-23.44002964,-23.75115587,-24.05604019,
  -24.35585551,-24.65165989,-24.94318163,-25.23134749,-25.51773359,
  -25.80527252,-26.09658909,-26.38987929,-26.68921725,-26.99522553,
  -27.30935474,-27.6327618 ,-27.96603588,-28.30735935,-28.65948307,
  -29.02319435,-29.39791469,-29.7841175 ,-30.1758229 ,-30.58508396,
  -31.00091729,-31.42561208,-31.85678936,-32.28888736,-32.48230803},
 { -1.91423155, -2.00180267, -2.20804153, -2.42726439, -2.65651081,
   -2.89464831, -3.14015624, -3.38861984, -3.64083196, -3.89596306,
   -4.15332392, -4.41284585, -4.67415855, -4.93668049, -5.19995887,
   -5.46381336, -5.72820665, -5.99351317, -6.26008525, -6.52859724,
   -6.8003165 , -7.07378653, -7.34767548, -7.62241258, -7.89829718,
   -8.17507789, -8.45280582, -8.73157248, -9.01135861, -9.2919952 ,
   -9.5742631 , -9.85834705,-10.14462682,-10.43337603,-10.72498753,
  -11.01974018,-11.31755697,-11.61877175,-11.92373193,-12.23217169,
  -12.54402602,-12.85878014,-13.17662176,-13.49728257,-13.82058881,
  -14.14662453,-14.47495924,-14.80508392,-15.13703781,-15.47088364,
  -15.80697994,-16.14567639,-16.48596008,-16.82771587,-17.17139039,
  -17.51717995,-17.86515662,-18.21518673,-18.56702135,-18.92062575,
  -19.27581541,-19.63215984,-19.98905966,-20.34619338,-20.70319168,
  -21.05866488,-21.41078553,-21.75953443,-22.10460524,-22.4439069 ,
  -22.77640249,-23.10221636,-23.42146429,-23.73418846,-24.04008784,
  -24.34031809,-24.63594864,-24.92676966,-25.21376738,-25.49860003,
  -25.78420431,-26.07320573,-26.36403391,-26.66073058,-26.96401061,
  -27.27537606,-27.59607404,-27.92672099,-28.26575994,-28.61589389,
  -28.97803641,-29.35177152,-29.73765232,-30.13033154,-30.54061803,
  -30.95859476,-31.38626514,-31.82160415,-32.25921863,-32.45550986},
 { -1.89878953, -1.98540309, -2.18940088, -2.40636244, -2.63339788,
   -2.86920994, -3.11231112, -3.35913702, -3.61008   , -3.86425888,
   -4.12097635, -4.38005253, -4.64105384, -4.90336191, -5.16648395,
   -5.43016104, -5.69424646, -5.95901743, -6.22478058, -6.49215366,
   -6.76219479, -7.03390034, -7.30634439, -7.57985458, -7.85461865,
   -8.13041528, -8.4072369 , -8.68509902, -8.96389219, -9.24334363,
   -9.52413002, -9.80636314,-10.09039353,-10.37648812,-10.66508246,
  -10.9565398 ,-11.25087638,-11.54852509,-11.849926  ,-12.15491088,
  -12.46350238,-12.77524643,-13.09037912,-13.40865263,-13.72991198,
  -14.0542506 ,-14.38121951,-14.71030309,-15.04154161,-15.37496507,
  -15.71094376,-16.04981566,-16.39057619,-16.7331101 ,-17.07787094,
  -17.42507758,-17.77480191,-18.12694661,-18.48126482,-18.83764059,
  -19.19595054,-19.55585212,-19.91677017,-20.27828132,-20.63997008,
  -21.00049721,-21.35797491,-21.71210226,-22.06238696,-22.4067143 ,
  -22.74385118,-23.07368254,-23.39630778,-23.7117268 ,-24.01958932,
  -24.32102032,-24.61709298,-24.90766318,-25.19378281,-25.47720009,
  -25.76086174,-26.04740296,-26.33550988,-26.62919729,-26.92928422,
  -27.23733381,-27.55469105,-27.88200721,-28.21801042,-28.56536406,
  -28.92512474,-29.29706143,-29.68184605,-30.07484302,-30.48557179,
  -30.90532599,-31.33585327,-31.77562236,-32.21956216,-32.41929779},
 { -1.88381219, -1.9692225 , -2.17031669, -2.38421014, -2.60810832,
   -2.84058928, -3.08022424, -3.32425994, -3.57280251, -3.82499336,
   -4.08016997, -4.33807607, -4.59823567, -4.8600023 , -5.12283467,
   -5.38636573, -5.65028771, -5.91470686, -6.17981608, -6.44611325,
   -6.71442872, -6.98418591, -7.25485386, -7.52671251, -7.79990965,
   -8.07430367, -8.34987774, -8.62660535, -8.9043009 , -9.18257562,
   -9.46195875, -9.74243407,-10.0242605 ,-10.30763346,-10.59298276,
  -10.88072965,-11.17097312,-11.46425152,-11.76112076,-12.06154523,
  -12.36568477,-12.67319369,-12.98439792,-13.29910638,-13.61721359,
  -13.93883997,-14.26352859,-14.59076422,-14.92058584,-15.25298556,
  -15.58833646,-15.92695563,-16.26784074,-16.61087019,-16.95649846,
  -17.3049642 ,-17.65633795,-18.01056268,-18.36739957,-18.72665548,
  -19.08828192,-19.45204841,-19.81743164,-20.18392319,-20.55108777,
  -20.91768915,-21.28182228,-21.64288395,-22.00015557,-22.35147095,
  -22.69533382,-23.0312927 ,-23.35933903,-23.67934559,-23.99087418,
  -24.29498104,-24.59271754,-24.88400195,-25.16995559,-25.45242546,
  -25.73437708,-26.01847058,-26.303684  ,-26.59401548,-26.89040653,
  -27.19449401,-27.50772947,-27.83080893,-28.16277204,-28.50625214,
  -28.86246449,-29.23138709,-29.61385517,-30.00602916,-30.41611983,
  -30.83679601,-31.26961344,-31.71373547,-32.16467851,-32.36847932},
 { -1.87152689, -1.95562311, -2.15339423, -2.36353446, -2.58332565,
   -2.81124068, -3.04591775, -3.28533689, -3.52947835, -3.77762896,
   -4.02925828, -4.28413278, -4.541821  , -4.80172382, -5.06330349,
   -5.32610503, -5.58964232, -5.85377712, -6.11848646, -6.38402678,
   -6.65091434, -6.91888207, -7.18770643, -7.45763919, -7.72884977,
   -8.00133292, -8.27514485, -8.55030204, -8.82661723, -9.10363123,
   -9.38171657, -9.66068966, -9.94064229,-10.22159439,-10.50386777,
  -10.7878571 ,-11.07367723,-11.36193182,-11.65328693,-11.94786002,
  -12.24600843,-12.54756412,-12.85301321,-13.16229437,-13.47542064,
  -13.79258838,-14.11337076,-14.43728258,-14.76437098,-15.09459242,
  -15.42831269,-15.76581534,-16.10609076,-16.44899848,-16.79497954,
  -17.14428075,-17.49696284,-17.8530045 ,-18.21217606,-18.57421183,
  -18.93914624,-19.30688035,-19.67697279,-20.04885935,-20.42213077,
  -20.795735  ,-21.16783776,-21.53756275,-21.90396583,-22.26483262,
  -22.61835036,-22.96361265,-23.30035615,-23.62816685,-23.94642109,
  -24.25600386,-24.55786384,-24.85194405,-25.13941815,-25.42223096,
  -25.70337527,-25.98556139,-26.26811724,-26.55504605,-26.84744264,
  -27.14703486,-27.45538938,-27.77326044,-28.10001865,-28.43827779,
  -28.7894192 ,-29.15364796,-29.53200343,-29.92150161,-30.32909563,
  -30.74896471,-31.18258168,-31.63005164,-32.08788321,-32.29610963},
 { -1.86509805, -1.94830085, -2.14365336, -2.35078978, -2.56694699,
   -2.79041767, -3.01978697, -3.2534728 , -3.49141594, -3.73310691,
   -3.97823709, -4.22674814, -4.47842384, -4.73289648, -4.989821  ,
   -5.24884766, -5.50949716, -5.77151394, -6.03471411, -6.29909891,
   -6.56482657, -6.83170279, -7.09956675, -7.36852476, -7.63867813,
   -7.91006726, -8.18279968, -8.4569704 , -8.73247384, -9.00888787,
   -9.28650031, -9.56502401, -9.84439103,-10.12439709,-10.40516092,
  -10.68692772,-10.96969659,-11.2540108 ,-11.54055317,-11.82952942,
  -12.12149147,-12.41647754,-12.71518588,-13.01776713,-13.32444588,
  -13.63557671,-13.95084408,-14.26986197,-14.59272718,-14.91939364,
  -15.25022407,-15.58546795,-15.92410445,-16.26596215,-16.61144919,
  -16.96079743,-17.3140402 ,-17.67116856,-18.03195035,-18.39605613,
  -18.76358196,-19.13453862,-19.508563  ,-19.88506232,-20.26369495,
  -20.64364608,-21.02324398,-21.40146515,-21.77724693,-22.14840853,
  -22.51290015,-22.86938217,-23.21725323,-23.55567512,-23.88372018,
  -24.20194653,-24.51104458,-24.81086206,-25.1025365 ,-25.38805159,
  -25.67040736,-25.95238024,-26.23368081,-26.51835205,-26.807669  ,
  -27.10346081,-27.40740368,-27.72031847,-28.04186221,-28.37463916,
  -28.72016674,-29.07884725,-29.45191367,-29.83711461,-30.24044313,
  -30.65739934,-31.08949297,-31.53781095,-32.00008488,-32.21175497},
 { -1.86509805, -1.94830085, -2.14365336, -2.35078978, -2.56694699,
   -2.79041767, -3.01978697, -3.2534728 , -3.49141594, -3.73310691,
   -3.97823709, -4.22674814, -4.47842384, -4.73289648, -4.989821  ,
   -5.24884766, -5.50949716, -5.77151394, -6.03471411, -6.29909891,
   -6.56482657, -6.83170279, -7.09956675, -7.36852476, -7.63867813,
   -7.91006726, -8.18279968, -8.4569704 , -8.73247384, -9.00888787,
   -9.28650031, -9.56502401, -9.84439103,-10.12439709,-10.40516092,
  -10.68692772,-10.96969659,-11.2540108 ,-11.54055317,-11.82952942,
  -12.12149147,-12.41647754,-12.71518588,-13.01776713,-13.32444588,
  -13.63557671,-13.95084408,-14.26986197,-14.59272718,-14.91939364,
  -15.25022407,-15.58546795,-15.92410445,-16.26596215,-16.61144919,
  -16.96079743,-17.3140402 ,-17.67116856,-18.03195035,-18.39605613,
  -18.76358196,-19.13453862,-19.508563  ,-19.88506232,-20.26369495,
  -20.64364608,-21.02324398,-21.40146515,-21.77724693,-22.14840853,
  -22.51290015,-22.86938217,-23.21725323,-23.55567512,-23.88372018,
  -24.20194653,-24.51104458,-24.81086206,-25.1025365 ,-25.38805159,
  -25.67040736,-25.95238024,-26.23368081,-26.51835205,-26.807669  ,
  -27.10346081,-27.40740368,-27.72031847,-28.04186221,-28.37463916,
  -28.72016674,-29.07884725,-29.45191367,-29.83711461,-30.24044313,
  -30.65739934,-31.08949297,-31.53781095,-32.00008488,-32.21175497},
 { -1.87152689, -1.95562311, -2.15339423, -2.36353446, -2.58332565,
   -2.81124068, -3.04591775, -3.28533689, -3.52947835, -3.77762896,
   -4.02925828, -4.28413278, -4.541821  , -4.80172382, -5.06330349,
   -5.32610503, -5.58964232, -5.85377712, -6.11848646, -6.38402678,
   -6.65091434, -6.91888207, -7.18770643, -7.45763919, -7.72884977,
   -8.00133292, -8.27514485, -8.55030204, -8.82661723, -9.10363123,
   -9.38171657, -9.66068966, -9.94064229,-10.22159439,-10.50386777,
  -10.7878571 ,-11.07367723,-11.36193182,-11.65328693,-11.94786002,
  -12.24600843,-12.54756412,-12.85301321,-13.16229437,-13.47542064,
  -13.79258838,-14.11337076,-14.43728258,-14.76437098,-15.09459242,
  -15.42831269,-15.76581534,-16.10609076,-16.44899848,-16.79497954,
  -17.14428075,-17.49696284,-17.8530045 ,-18.21217606,-18.57421183,
  -18.93914624,-19.30688035,-19.67697279,-20.04885935,-20.42213077,
  -20.795735  ,-21.16783776,-21.53756275,-21.90396583,-22.26483262,
  -22.61835036,-22.96361265,-23.30035615,-23.62816685,-23.94642109,
  -24.25600386,-24.55786384,-24.85194405,-25.13941815,-25.42223096,
  -25.70337527,-25.98556139,-26.26811724,-26.55504605,-26.84744264,
  -27.14703486,-27.45538938,-27.77326044,-28.10001865,-28.43827779,
  -28.7894192 ,-29.15364796,-29.53200343,-29.92150161,-30.32909563,
  -30.74896471,-31.18258168,-31.63005164,-32.08788321,-32.29610963},
 { -1.88381219, -1.9692225 , -2.17031669, -2.38421014, -2.60810832,
   -2.84058928, -3.08022424, -3.32425994, -3.57280251, -3.82499336,
   -4.08016997, -4.33807607, -4.59823567, -4.8600023 , -5.12283467,
   -5.38636573, -5.65028771, -5.91470686, -6.17981608, -6.44611325,
   -6.71442872, -6.98418591, -7.25485386, -7.52671251, -7.79990965,
   -8.07430367, -8.34987774, -8.62660535, -8.9043009 , -9.18257562,
   -9.46195875, -9.74243407,-10.0242605 ,-10.30763346,-10.59298276,
  -10.88072965,-11.17097312,-11.46425152,-11.76112076,-12.06154523,
  -12.36568477,-12.67319369,-12.98439792,-13.29910638,-13.61721359,
  -13.93883997,-14.26352859,-14.59076422,-14.92058584,-15.25298556,
  -15.58833646,-15.92695563,-16.26784074,-16.61087019,-16.95649846,
  -17.3049642 ,-17.65633795,-18.01056268,-18.36739957,-18.72665548,
  -19.08828192,-19.45204841,-19.81743164,-20.18392319,-20.55108777,
  -20.91768915,-21.28182228,-21.64288395,-22.00015557,-22.35147095,
  -22.69533382,-23.0312927 ,-23.35933903,-23.67934559,-23.99087418,
  -24.29498104,-24.59271754,-24.88400195,-25.16995559,-25.45242546,
  -25.73437708,-26.01847058,-26.303684  ,-26.59401548,-26.89040653,
  -27.19449401,-27.50772947,-27.83080893,-28.16277204,-28.50625214,
  -28.86246449,-29.23138709,-29.61385517,-30.00602916,-30.41611983,
  -30.83679601,-31.26961344,-31.71373547,-32.16467851,-32.36847932},
 { -1.89878953, -1.98540309, -2.18940088, -2.40636244, -2.63339788,
   -2.86920994, -3.11231112, -3.35913702, -3.61008   , -3.86425888,
   -4.12097635, -4.38005253, -4.64105384, -4.90336191, -5.16648395,
   -5.43016104, -5.69424646, -5.95901743, -6.22478058, -6.49215366,
   -6.76219479, -7.03390034, -7.30634439, -7.57985458, -7.85461865,
   -8.13041528, -8.4072369 , -8.68509902, -8.96389219, -9.24334363,
   -9.52413002, -9.80636314,-10.09039353,-10.37648812,-10.66508246,
  -10.9565398 ,-11.25087638,-11.54852509,-11.849926  ,-12.15491088,
  -12.46350238,-12.77524643,-13.09037912,-13.40865263,-13.72991198,
  -14.0542506 ,-14.38121951,-14.71030309,-15.04154161,-15.37496507,
  -15.71094376,-16.04981566,-16.39057619,-16.7331101 ,-17.07787094,
  -17.42507758,-17.77480191,-18.12694661,-18.48126482,-18.83764059,
  -19.19595054,-19.55585212,-19.91677017,-20.27828132,-20.63997008,
  -21.00049721,-21.35797491,-21.71210226,-22.06238696,-22.4067143 ,
  -22.74385118,-23.07368254,-23.39630778,-23.7117268 ,-24.01958932,
  -24.32102032,-24.61709298,-24.90766318,-25.19378281,-25.47720009,
  -25.76086174,-26.04740296,-26.33550988,-26.62919729,-26.92928422,
  -27.23733381,-27.55469105,-27.88200721,-28.21801042,-28.56536406,
  -28.92512474,-29.29706143,-29.68184605,-30.07484302,-30.48557179,
  -30.90532599,-31.33585327,-31.77562236,-32.21956216,-32.41929779},
 { -1.91423155, -2.00180267, -2.20804153, -2.42726439, -2.65651081,
   -2.89464831, -3.14015624, -3.38861984, -3.64083196, -3.89596306,
   -4.15332392, -4.41284585, -4.67415855, -4.93668049, -5.19995887,
   -5.46381336, -5.72820665, -5.99351317, -6.26008525, -6.52859724,
   -6.8003165 , -7.07378653, -7.34767548, -7.62241258, -7.89829718,
   -8.17507789, -8.45280582, -8.73157248, -9.01135861, -9.2919952 ,
   -9.5742631 , -9.85834705,-10.14462682,-10.43337603,-10.72498753,
  -11.01974018,-11.31755697,-11.61877175,-11.92373193,-12.23217169,
  -12.54402602,-12.85878014,-13.17662176,-13.49728257,-13.82058881,
  -14.14662453,-14.47495924,-14.80508392,-15.13703781,-15.47088364,
  -15.80697994,-16.14567639,-16.48596008,-16.82771587,-17.17139039,
  -17.51717995,-17.86515662,-18.21518673,-18.56702135,-18.92062575,
  -19.27581541,-19.63215984,-19.98905966,-20.34619338,-20.70319168,
  -21.05866488,-21.41078553,-21.75953443,-22.10460524,-22.4439069 ,
  -22.77640249,-23.10221636,-23.42146429,-23.73418846,-24.04008784,
  -24.34031809,-24.63594864,-24.92676966,-25.21376738,-25.49860003,
  -25.78420431,-26.07320573,-26.36403391,-26.66073058,-26.96401061,
  -27.27537606,-27.59607404,-27.92672099,-28.26575994,-28.61589389,
  -28.97803641,-29.35177152,-29.73765232,-30.13033154,-30.54061803,
  -30.95859476,-31.38626514,-31.82160415,-32.25921863,-32.45550986},
 { -1.92920943, -2.01751189, -2.22542597, -2.44628129, -2.677076  ,
   -2.91687442, -3.16414132, -3.41358179, -3.66646408, -3.92205039,
   -4.17967263, -4.43937814, -4.70085568, -4.96354904, -5.22702427,
   -5.49114876, -5.75595356, -6.02186361, -6.28924486, -6.55880429,
   -6.83203055, -7.10701844, -7.38203751, -7.65766568, -7.93436567,
   -8.21188269, -8.49034606, -8.76992732, -9.05068651, -9.33253179,
   -9.61630761, -9.90223046,-10.19067161,-10.48187881,-10.77618467,
  -11.07378246,-11.37451047,-11.67862055,-11.98639124,-12.29748739,
  -12.61178896,-12.92874872,-13.2485281 ,-13.57085516,-13.89555032,
  -14.22269364,-14.55187455,-14.88259098,-15.21487713,-15.54882338,
  -15.88477074,-16.223075  ,-16.56271197,-16.90356394,-17.24606888,
  -17.59040141,-17.93663553,-18.28460733,-18.63407227,-18.9850792 ,
  -19.33739503,-19.69052148,-20.04385464,-20.39718089,-20.75018903,
  -21.10146913,-21.44927047,-21.79382096,-22.13495635,-22.47058137,
  -22.79980442,-23.12292654,-23.44002964,-23.75115587,-24.05604019,
  -24.35585551,-24.65165989,-24.94318163,-25.23134749,-25.51773359,
  -25.80527252,-26.09658909,-26.38987929,-26.68921725,-26.99522553,
  -27.30935474,-27.6327618 ,-27.96603588,-28.30735935,-28.65948307,
  -29.02319435,-29.39791469,-29.7841175 ,-30.1758229 ,-30.58508396,
  -31.00091729,-31.42561208,-31.85678936,-32.28888736,-32.48230803},
 { -1.94329036, -2.03213771, -2.24127793, -2.46329133, -2.69515972,
   -2.93616686, -3.18477605, -3.43479234, -3.68800938, -3.94380291,
   -4.201526  , -4.46133435, -4.722963  , -4.98586582, -5.24960773,
   -5.5140797 , -5.77935263, -6.04587411, -6.31401078, -6.58449618,
   -6.85906085, -7.13536276, -7.41128204, -7.68757935, -7.96491418,
   -8.24303919, -8.52216527, -8.80253585, -9.08427289, -9.36733651,
   -9.65260441, -9.94029803,-10.23075979,-10.52419711,-10.82087925,
  -11.12092154,-11.42409059,-11.73057316,-12.04059775,-12.35378013,
  -12.66996589,-12.98859192,-13.30980512,-13.63333766,-13.95900948,
  -14.28689768,-14.6166103 ,-14.94765091,-15.28004526,-15.6139075 ,
  -15.9495577 ,-16.28735452,-16.62626132,-16.96615712,-17.30747134,
  -17.65035931,-17.99489946,-18.34090396,-18.6881382 ,-19.0367353 ,
  -19.3864236 ,-19.73665259,-20.08682657,-20.43683916,-20.78644088,
  -21.13421833,-21.47850094,-21.8197291 ,-22.15784362,-22.49072396,
  -22.81758876,-23.13887632,-23.45460716,-23.76480156,-24.06922671,
  -24.36906811,-24.66537054,-24.95780507,-25.24724452,-25.53518904,
  -25.82457109,-26.11802057,-26.41351611,-26.71516756,-27.0235136 ,
  -27.33996095,-27.66558331,-28.00094845,-28.34399959,-28.69754235,
  -29.06225369,-29.43741207,-29.82344367,-30.21380494,-30.62173713,
  -31.03531033,-31.45710846,-31.88449348,-32.31182134,-32.50284422},
 { -1.95648354, -2.04573474, -2.25577111, -2.47860797, -2.7112297 ,
   -2.9531539 , -3.20285053, -3.45320864, -3.70658079, -3.96246561,
   -4.2202308 , -4.48012851, -4.7419261 , -5.00507435, -5.26912266,
   -5.53396998, -5.79970939, -6.06679625, -6.33559572, -6.60687019,
   -6.88261378, -7.1600597 , -7.43670539, -7.71351773, -7.99137355,
   -8.27003457, -8.54978888, -8.83093956, -9.11365341, -9.39792185,
   -9.68463459, -9.97400139,-10.26632565,-10.56176934,-10.86054129,
  -11.16268879,-11.46791944,-11.77636901,-12.08822999,-12.40308307,
  -12.72075263,-13.04066947,-13.36297225,-13.68740067,-14.01377623,
  -14.34217252,-14.67221431,-15.00340921,-15.33577206,-15.66943793,
  -16.00470402,-16.34193006,-16.68006687,-17.01899033,-17.35912243,
  -17.70060201,-18.04351453,-18.38765397,-18.73280005,-19.07916939,
  -19.42645949,-19.77407922,-20.12144895,-20.46856523,-20.81523946,
  -21.16006394,-21.50144591,-21.84000792,-22.17576677,-22.50656209,
  -22.83169893,-23.15172756,-23.46659175,-23.77627804,-24.08058552,
  -24.3807109 ,-24.67768557,-24.97112759,-25.26186035,-25.55131298,
  -25.84242062,-26.13782224,-26.43529166,-26.73897657,-27.04933828,
  -27.36774575,-27.6951957 ,-28.03223932,-28.37659952,-28.7311423 ,
  -29.09644872,-29.47167075,-29.85721386,-30.24602966,-30.65248756,
  -31.06381012,-31.4828725 ,-31.90684237,-32.33004138,-32.51904513},
 { -1.96881896, -2.05836434, -2.26904568, -2.4924592 , -2.7256061 ,
   -2.96824651, -3.21886201, -3.46941523, -3.722841  , -3.97876364,
   -4.23655653, -4.49655581, -4.75854827, -5.02197119, -5.28634853,
   -5.55157706, -5.81776079, -6.08535483, -6.35472536, -6.62666887,
   -6.90346241, -7.18192496, -7.45917543, -7.73640231, -8.01471194,
   -8.29387189, -8.57424002, -8.85616655, -9.13984845, -9.42529278,
   -9.71338681,-10.00431883,-10.29834896,-10.5955934 ,-10.89620585,
  -11.20017536,-11.50716146,-11.8172602 ,-12.13063834,-12.44685118,
  -12.76571045,-13.08664663,-13.40979359,-13.73489987,-14.06178912,
  -14.39053042,-14.72076341,-15.05199834,-15.38423744,-15.71763462,
  -16.05246328,-16.38908329,-16.72643333,-17.06438687,-17.40335987,
  -17.74347752,-18.0848347 ,-18.42721217,-18.77040724,-19.11471829,
  -19.45981775,-19.80508249,-20.14995348,-20.49452413,-20.83866369,
  -21.18097503,-21.5199386 ,-21.85633371,-22.19023098,-22.51942055,
  -22.84327742,-23.16244717,-23.47678808,-23.78624619,-24.09065326,
  -24.39121707,-24.68895608,-24.98343896,-25.27544343,-25.56633166,
  -25.85904355,-26.15623004,-26.45547035,-26.76095149,-27.07306261,
  -27.39314001,-27.72210914,-28.06050865,-28.40585767,-28.7610871 ,
  -29.12669499,-29.50172088,-29.88657085,-30.27374196,-30.67867108,
  -31.08781571,-31.50433177,-31.92523739,-32.34484626,-32.53213335},
 { -1.98015639, -2.06990581, -2.28102841, -2.5048243 , -2.73832406,
   -2.98153484, -3.23295258, -3.4836111 , -3.73704168, -3.9929935 ,
   -4.25083558, -4.51097506, -4.77320619, -5.03694404, -5.3016799 ,
   -5.56730132, -5.83391547, -6.10197286, -6.37184525, -6.64436918,
   -6.92212103, -7.20151475, -7.47929293, -7.75687533, -8.03560464,
   -8.31524896, -8.59622776, -8.87892723, -9.16356273, -9.45014546,
   -9.73955079,-10.03194011,-10.32752948,-10.62639137,-10.92863038,
  -11.23418615,-11.54267921,-11.85417477,-12.16882135,-12.48615571,
  -12.80598245,-13.12773531,-13.45154511,-13.77716961,-14.10443447,
  -14.43340331,-14.76372896,-15.09492324,-15.42697458,-15.76005429,
  -16.09441157,-16.43040613,-16.7669652 ,-17.10396077,-17.44180432,
  -17.78061009,-18.12048441,-18.46119902,-18.80257118,-19.14497854,
  -19.48807276,-19.83120512,-20.17383955,-20.51615953,-20.85808813,
  -21.19824132,-21.53516751,-21.86978185,-22.202192  ,-22.53013232,
  -22.85303624,-23.17163324,-23.48569116,-23.79511144,-24.09975962,
  -24.40085482,-24.69940318,-24.99492706,-25.28816168,-25.58040571,
  -25.87460545,-26.17342592,-26.47426044,-26.78133635,-27.09497504,
  -27.41648448,-27.74672402,-28.0862232 ,-28.43231211,-28.78799004,
  -29.15368342,-29.52833128,-29.91235745,-30.2978475 ,-30.70124633,
  -31.10831576,-31.52247839,-31.94063427,-32.35710298,-32.54291653}};
real cos_theta_grid[20] = {-1.        ,-0.89473684,-0.78947368,-0.68421053,-0.57894737,-0.47368421,
 -0.36842105,-0.26315789,-0.15789474,-0.05263158, 0.05263158, 0.15789474,
  0.26315789, 0.36842105, 0.47368421, 0.57894737, 0.68421053, 0.78947368,
  0.89473684, 1.        };
real log_energy_grid[100] = {0.        ,0.09090909,0.18181818,0.27272727,0.36363636,0.45454545,
 0.54545455,0.63636364,0.72727273,0.81818182,0.90909091,1.        ,
 1.09090909,1.18181818,1.27272727,1.36363636,1.45454545,1.54545455,
 1.63636364,1.72727273,1.81818182,1.90909091,2.        ,2.09090909,
 2.18181818,2.27272727,2.36363636,2.45454545,2.54545455,2.63636364,
 2.72727273,2.81818182,2.90909091,3.        ,3.09090909,3.18181818,
 3.27272727,3.36363636,3.45454545,3.54545455,3.63636364,3.72727273,
 3.81818182,3.90909091,4.        ,4.09090909,4.18181818,4.27272727,
 4.36363636,4.45454545,4.54545455,4.63636364,4.72727273,4.81818182,
 4.90909091,5.        ,5.09090909,5.18181818,5.27272727,5.36363636,
 5.45454545,5.54545455,5.63636364,5.72727273,5.81818182,5.90909091,
 6.        ,6.09090909,6.18181818,6.27272727,6.36363636,6.45454545,
 6.54545455,6.63636364,6.72727273,6.81818182,6.90909091,7.        ,
 7.09090909,7.18181818,7.27272727,7.36363636,7.45454545,7.54545455,
 7.63636364,7.72727273,7.81818182,7.90909091,8.        ,8.09090909,
 8.18181818,8.27272727,8.36363636,8.45454545,8.54545455,8.63636364,
 8.72727273,8.81818182,8.90909091,9.        };
vector[2] vector_interp_energies;
vector[2] vector_coz_grid_points;
vector_interp_energies[1] = interpolate(to_vector(log_energy_grid), to_vector(AtmosphericFluxPolyCoeffs[binary_search(abs(cos(pi() - acos(true_dir[3]))), cos_theta_grid)]), log10(truncate_value(true_energy, 1.0, 1000000000.0)));
vector_interp_energies[2] = interpolate(to_vector(log_energy_grid), to_vector(AtmosphericFluxPolyCoeffs[(binary_search(abs(cos(pi() - acos(true_dir[3]))), cos_theta_grid)+1)]), log10(truncate_value(true_energy, 1.0, 1000000000.0)));
vector_coz_grid_points[1] = cos_theta_grid[binary_search(abs(cos(pi() - acos(true_dir[3]))), cos_theta_grid)];
vector_coz_grid_points[2] = cos_theta_grid[(binary_search(abs(cos(pi() - acos(true_dir[3]))), cos_theta_grid)+1)];
return ((10^interpolate(vector_coz_grid_points, vector_interp_energies, abs(cos(pi() - acos(true_dir[3])))))*10000.0);
}
}
parameters
{
real<lower=100.0, upper=1000000000.0> energy;
real<lower=-1, upper=1> coszen;
}
transformed parameters
{
vector[3] omega;
real zen;
real sinzen;
zen = acos(coszen);
sinzen = sin(zen);
omega[1] = sinzen;
omega[2] = 0;
omega[3] = coszen;
}
model
{
target += log(AtmopshericNumuFlux(energy, omega));
}
generated quantities
{
real pl_samples;
vector[3] diffuse_events;
pl_samples = spectrum_rng(2, 100.0, 1000000000.0);
diffuse_events = diffuse_bg_rng(2, 100.0, 1000000000.0);
}
